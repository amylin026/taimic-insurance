<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>TAIMIC | Global Wealth</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- FontAwesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />

  <!-- Fonts -->
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+TC:wght@300;400;500;700&display=swap"
    rel="stylesheet"
  />

  <style>
    :root {
      --tm-blue: #1d4ed8;
      --tm-blue-soft: #eff4ff;
      --tm-gray-bg: #f3f4f6;
      --tm-border: #e5e7eb;
      --tm-text: #111827;
    }

    body {
      font-family: 'Inter', 'Noto Sans TC', system-ui, -apple-system, BlinkMacSystemFont,
        'Segoe UI', sans-serif;
      background: #f5f5f7;
      color: var(--tm-text);
    }

    /* ====== Layout ====== */
    .tm-shell {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .tm-main {
      flex: 1;
      background: #f5f5f7;
    }

    .tm-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 1.5rem 1.5rem 3rem;
    }

    /* ====== Header (TSMC 風格) ====== */
    .tm-header {
      background: #ffffff;
      border-bottom: 1px solid var(--tm-border);
    }

    .tm-header-inner {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0.75rem 1.5rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1.5rem;
    }

    .tm-brand {
      display: flex;
      align-items: center;
      gap: 0.9rem;
    }

    /* 會動的時鐘 Logo（主 Logo） */
    .tm-logo-mark {
      position: relative;
      width: 46px;
      height: 46px;
      border-radius: 9999px;
      background: radial-gradient(circle at 30% 20%, #9ec5ff, #3b82f6);
      box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.12),
        0 12px 24px rgba(15, 23, 42, 0.18);
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .tm-logo-mark::before {
      content: '';
      position: absolute;
      inset: 6px;
      border-radius: 9999px;
      border: 2px solid rgba(255, 255, 255, 0.75);
    }

    .tm-logo-mark::after {
      content: '';
      position: absolute;
      width: 6px;
      height: 6px;
      border-radius: 9999px;
      background: #ffffff;
      z-index: 2;
    }

    .tm-clock-hand {
      position: absolute;
      width: 2px;
      border-radius: 9999px;
      background: #ffffff;
      transform-origin: bottom center;
    }

    .tm-hand-hour {
      height: 12px;
      bottom: 50%;
      animation: tm-hour-rotate 12s linear infinite;
    }

    .tm-hand-minute {
      height: 18px;
      bottom: 50%;
      animation: tm-minute-rotate 4s linear infinite;
    }

    @keyframes tm-hour-rotate {
      from {
        transform: rotate(0deg);
      }
      to {
        transform: rotate(360deg);
      }
    }

    @keyframes tm-minute-rotate {
      from {
        transform: rotate(0deg);
      }
      to {
        transform: rotate(720deg);
      }
    }

    .tm-logo-text-main {
      font-weight: 700;
      letter-spacing: 0.15em;
      font-size: 18px;
      color: #1f2937;
    }

    .tm-logo-text-sub {
      font-size: 11px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: #6b7280;
      margin-top: 2px;
    }

    .tm-nav {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .tm-chip-toggle {
      display: inline-flex;
      border-radius: 9999px;
      border: 1px solid var(--tm-border);
      background: #f9fafb;
      padding: 2px;
    }

    .tm-chip-toggle button {
      padding: 0.2rem 0.8rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      border: none;
      background: transparent;
      cursor: pointer;
      color: #4b5563;
    }

    .tm-chip-toggle button.tm-active {
      background: #ffffff;
      box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.03);
      color: #111827;
    }

    /* 語言切換：只留地球 icon */
    #lang-toggle {
      border: none;
      background: transparent;
      padding: 0;
      cursor: pointer;
    }

    #lang-toggle i {
      font-size: 1.1rem;
      color: #4b5563;
    }

    #lang-toggle:hover i {
      color: #111827;
    }

    .tm-avatar-btn {
      width: 34px;
      height: 34px;
      border-radius: 9999px;
      border: 1px solid var(--tm-border);
      background: #f9fafb;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: #4b5563;
    }

    .tm-avatar-btn:hover {
      background: #ffffff;
    }

    .tm-menu {
      position: absolute;
      right: 0;
      margin-top: 0.5rem;
      width: 180px;
      background: #ffffff;
      border-radius: 0.75rem;
      border: 1px solid var(--tm-border);
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.15);
      padding: 0.5rem 0;
      z-index: 40;
    }

    .tm-menu-item {
      padding: 0.5rem 1rem;
      font-size: 0.875rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .tm-menu-item:hover {
      background: #f3f4f6;
    }

    /* ====== Cards ====== */
    .tm-card {
      background: #ffffff;
      border-radius: 1rem;
      border: 1px solid var(--tm-border);
      box-shadow: 0 8px 16px rgba(15, 23, 42, 0.04);
    }

    .tm-card-header {
      padding: 1rem 1.25rem 0.5rem;
      border-bottom: 1px solid #f3f4f6;
    }

    .tm-badge {
      display: inline-flex;
      align-items: center;
      border-radius: 9999px;
      background: #ecfdf5;
      color: #15803d;
      padding: 0.15rem 0.65rem;
      font-size: 0.75rem;
      gap: 0.25rem;
    }

    /* ====== Footer - TSMC style ====== */
    .tm-footer {
      background: #f5f7fb;
      border-top: 1px solid var(--tm-border);
      margin-top: 3rem;
      font-size: 14px;
      color: #4b5563;
    }

    .tm-footer-inner {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2.25rem 1.5rem 1.75rem;
      display: flex;
      flex-direction: column;
      gap: 2rem;
    }

    .tm-footer-main {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 3rem;
      flex-wrap: wrap;
    }

    .tm-footer-left {
      max-width: 360px;
    }

    .tm-footer-logo {
      display: flex;
      align-items: center;
      gap: 0.9rem;
      margin-bottom: 0.75rem;
    }

    /* Footer 用的時鐘 Logo（放大一點） */
    .tm-footer-logo-mark {
      position: relative;
      width: 56px;
      height: 56px;
      border-radius: 9999px;
      background: radial-gradient(circle at 30% 20%, #9ec5ff, #3b82f6);
      box-shadow: 0 0 0 6px rgba(59, 130, 246, 0.12),
        0 14px 30px rgba(15, 23, 42, 0.18);
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .tm-footer-logo-mark::before {
      content: '';
      position: absolute;
      inset: 8px;
      border-radius: 9999px;
      border: 2px solid rgba(255, 255, 255, 0.75);
    }

    .tm-footer-logo-mark::after {
      content: '';
      position: absolute;
      width: 6px;
      height: 6px;
      border-radius: 9999px;
      background: #ffffff;
      z-index: 2;
    }

    .tm-footer-clock-hand {
      position: absolute;
      width: 2px;
      border-radius: 9999px;
      background: #ffffff;
      transform-origin: bottom center;
    }

    .tm-footer-hand-hour {
      height: 14px;
      bottom: 50%;
      animation: tm-hour-rotate 12s linear infinite;
    }

    .tm-footer-hand-minute {
      height: 20px;
      bottom: 50%;
      animation: tm-minute-rotate 4s linear infinite;
    }

    .tm-footer-logo-text-main {
      font-weight: 700;
      letter-spacing: 0.15em;
      font-size: 18px;
      color: #1f2937;
    }

    .tm-footer-logo-text-sub {
      font-size: 12px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: #6b7280;
      margin-top: 2px;
    }

    .tm-footer-tagline {
      margin-top: 0.25rem;
      color: #4b5563;
    }

    .tm-footer-cols {
      display: grid;
      grid-template-columns: repeat(4, minmax(120px, 1fr));
      gap: 1.75rem;
    }

    .tm-footer-col-title {
      font-size: 0.9rem;
      font-weight: 600;
      color: #111827;
      margin-bottom: 0.75rem;
    }

    .tm-footer-link {
      display: block;
      margin-bottom: 0.35rem;
      color: #4b5563;
      text-decoration: none;
    }

    .tm-footer-link:hover {
      color: #1d4ed8;
    }

    .tm-footer-bottom {
      border-top: 1px solid var(--tm-border);
      padding-top: 1.25rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .tm-footer-copy {
      color: #6b7280;
    }

    .tm-footer-social {
      display: flex;
      gap: 0.5rem;
    }

    .tm-footer-social a {
      width: 32px;
      height: 32px;
      border-radius: 9999px;
      border: 1px solid #d1d5db;
      background: #ffffff;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      color: #4b5563;
      transition:
        background 0.15s ease,
        color 0.15s ease,
        border-color 0.15s ease,
        transform 0.1s ease;
    }

    .tm-footer-social a:hover {
      background: #111827;
      color: #f9fafb;
      border-color: #111827;
      transform: translateY(-1px);
    }

    .tm-footer-social i {
      font-size: 0.9rem;
    }

    @media (max-width: 1024px) {
      .tm-footer-main {
        flex-direction: column;
        align-items: flex-start;
      }

      .tm-footer-cols {
        width: 100%;
        grid-template-columns: repeat(2, minmax(140px, 1fr));
      }
    }

    @media (max-width: 640px) {
      .tm-header-inner,
      .tm-footer-inner,
      .tm-container {
        padding-inline: 1rem;
      }

      .tm-footer-cols {
        grid-template-columns: repeat(2, minmax(120px, 1fr));
      }

      .tm-footer-bottom {
        flex-direction: column;
        align-items: flex-start;
      }
    }

    /* ====== Modal 基本樣式 ====== */
    .tm-modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.45);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 50;
    }

    .tm-modal {
      width: 100%;
      max-width: 460px;
      background: #ffffff;
      border-radius: 1rem;
      box-shadow: 0 25px 50px rgba(15, 23, 42, 0.25);
      overflow: hidden;
    }

    .tm-modal-header {
      background: var(--tm-blue);
      color: #ffffff;
      padding: 0.9rem 1.25rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .tm-modal-body {
      padding: 1.25rem 1.5rem 1.5rem;
    }

    .tm-modal-close {
      cursor: pointer;
    }

    .tm-input {
      width: 100%;
      border-radius: 0.75rem;
      border: 1px solid var(--tm-border);
      padding: 0.6rem 0.8rem;
      font-size: 0.9rem;
    }

    .tm-input:focus {
      outline: none;
      border-color: var(--tm-blue);
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.1);
    }

    .tm-primary-btn {
      width: 100%;
      border-radius: 9999px;
      background: var(--tm-blue);
      color: #ffffff;
      border: none;
      padding: 0.7rem 1rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      font-size: 0.95rem;
      cursor: pointer;
    }

    .tm-primary-btn:hover {
      background: #1e40af;
    }

    .tm-link {
      color: var(--tm-blue);
      cursor: pointer;
    }

    .tm-link:hover {
      text-decoration: underline;
    }
  </style>
</head>

<body>
  <div class="tm-shell">
    <!-- ========== HEADER ========== -->
    <header class="tm-header">
      <div class="tm-header-inner">
        <div class="tm-brand">
          <div class="tm-logo-mark">
            <div class="tm-clock-hand tm-hand-hour"></div>
            <div class="tm-clock-hand tm-hand-minute"></div>
          </div>
          <div>
            <div class="tm-logo-text-main">TAIMIC</div>
            <div class="tm-logo-text-sub">GLOBAL WEALTH</div>
          </div>
        </div>

        <div class="tm-nav">
          <!-- 貨幣切換（單純 UI） -->
          <div class="tm-chip-toggle">
            <button id="currency-usd" class="tm-active">USD</button>
            <button id="currency-twd">TWD</button>
          </div>

          <!-- 語言切換 -->
          <button id="lang-toggle" title="Language">
            <i class="fa-solid fa-globe"></i>
          </button>

          <!-- 使用者選單 -->
          <div class="relative">
            <button id="avatar-btn" class="tm-avatar-btn">
              <i class="fa-regular fa-user"></i>
            </button>
            <div id="user-menu" class="tm-menu hidden">
              <div class="tm-menu-item" id="menu-login">
                <i class="fa-solid fa-arrow-right-to-bracket"></i>
                <span data-i18n="menu.login">登入</span>
              </div>
              <div class="tm-menu-item" id="menu-register">
                <i class="fa-solid fa-user-plus"></i>
                <span data-i18n="menu.register">註冊</span>
              </div>
              <div class="tm-menu-item">
                <i class="fa-regular fa-circle-question"></i>
                <span>Help</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- ========== MAIN ========== -->
    <main class="tm-main">
      <div class="tm-container">
        <!-- Hero + CTA -->
        <section class="mb-6">
          <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-6">
            <div>
              <p class="text-xs tracking-[0.2em] text-slate-500 uppercase mb-1">
                FATCA / CRS · Cross-Border Wealth Platform
              </p>
              <h1 class="text-2xl md:text-3xl font-semibold text-slate-900 mb-2">
                全球資產一頁掌握，為跨境家庭設計的 <span class="text-blue-600">TAIMIC</span> 控制台。
              </h1>
              <p class="text-sm text-slate-600 max-w-xl">
                整合海外保單、證券與銀行帳戶，AI 自動讀取保單與帳單，幫你掌握稅務與傳承風險。
              </p>
            </div>
            <div class="flex gap-3">
              <button id="open-ocr" class="px-4 py-2.5 rounded-full bg-blue-600 text-white text-sm font-medium shadow">
                新增台灣資產 (AI OCR)
              </button>
              <button
                class="px-4 py-2.5 rounded-full border border-slate-300 text-sm text-slate-700 bg-white hover:bg-slate-50">
                查看分析報告
              </button>
            </div>
          </div>
        </section>

        <!-- Summary Cards -->
        <section class="grid md:grid-cols-3 gap-4 mb-6">
          <div class="tm-card">
            <div class="p-4">
              <div class="flex items-center justify-between mb-1">
                <span class="text-xs text-slate-500">美國境內資產</span>
                <img src="https://flagcdn.com/us.svg" class="w-5 h-3.5 rounded-sm shadow" alt="US" />
              </div>
              <div class="text-2xl font-semibold">$15,681,250</div>
              <div class="text-xs text-emerald-600 mt-1">+4.2% YTD</div>
            </div>
          </div>

          <div class="tm-card">
            <div class="p-4">
              <div class="flex items-center justify-between mb-1">
                <span class="text-xs text-slate-500">台灣資產</span>
                <img src="https://flagcdn.com/tw.svg" class="w-5 h-3.5 rounded-sm shadow" alt="TW" />
              </div>
              <div class="text-2xl font-semibold">$15,314,000</div>
              <div class="text-xs text-emerald-600 mt-1">+1.8% YTD</div>
            </div>
          </div>

          <div class="tm-card">
            <div class="p-4">
              <div class="flex items-center justify-between mb-1">
                <span class="text-xs text-slate-500">全球總資產淨值</span>
                <i class="fa-solid fa-globe text-slate-400"></i>
              </div>
              <div class="text-2xl font-semibold">$30,995,250</div>
              <div class="text-xs text-slate-500 mt-1">通盤稅務風險：安全</div>
            </div>
          </div>
        </section>

        <!-- Main Content: 左邊 AI 稅務警示 + Asset Table / 右邊 Pie Chart -->
        <section class="grid lg:grid-cols-[2fr,1.2fr] gap-6">
          <div class="flex flex-col gap-4">
            <!-- AI 稅務警示 -->
            <div class="tm-card">
              <div class="tm-card-header flex items-center justify-between">
                <div class="flex items-center gap-2">
                  <span class="text-sm font-medium text-slate-800">AI 稅務警示</span>
                  <span class="tm-badge text-xs"><i class="fa-solid fa-bolt"></i> FATCA 檢測</span>
                </div>
              </div>
              <div class="p-4 text-sm text-slate-700">
                系統掃描到一張新增的台灣萬壽保單，此金額已超過 IRS Form 8938 的 5 萬美元申報門檻。
                <span class="tm-link">檢視詳細分析報告 →</span>
              </div>
            </div>

            <!-- 資產持有清單 -->
            <div class="tm-card">
              <div class="tm-card-header">
                <div class="flex items-center justify-between">
                  <span class="text-sm font-medium text-slate-800">資產持有清單</span>
                  <span class="text-xs text-slate-500">AI 讀取的結果會自動加到這裡</span>
                </div>
              </div>
              <div class="p-4 overflow-x-auto">
                <table class="min-w-full text-sm">
                  <thead class="text-xs text-slate-500 border-b border-slate-100">
                    <tr>
                      <th class="text-left pb-2">資產名稱</th>
                      <th class="text-left pb-2">地區</th>
                      <th class="text-left pb-2">類別</th>
                      <th class="text-right pb-2">現值 (USD)</th>
                    </tr>
                  </thead>
                  <tbody id="assets-body" class="align-top text-sm"></tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Pie Chart -->
          <div class="tm-card h-full">
            <div class="tm-card-header">
              <span class="text-sm font-medium text-slate-800">區域資產配置</span>
            </div>
            <div class="p-4">
              <canvas id="asset-chart" class="w-full h-64"></canvas>
            </div>
          </div>
        </section>
      </div>
    </main>

    <!-- ========== FOOTER ========== -->
    <footer class="tm-footer">
      <div class="tm-footer-inner">
        <div class="tm-footer-main">
          <!-- 左邊 Logo + 標語 -->
          <div class="tm-footer-left">
            <div class="tm-footer-logo">
              <div class="tm-footer-logo-mark">
                <div class="tm-footer-clock-hand tm-footer-hand-hour"></div>
                <div class="tm-footer-clock-hand tm-footer-hand-minute"></div>
              </div>
              <div>
                <div class="tm-footer-logo-text-main">TAIMIC</div>
                <div class="tm-footer-logo-text-sub">GLOBAL WEALTH</div>
              </div>
            </div>
            <p class="tm-footer-tagline" data-i18n="footer.tagline">
              FATCA / CRS 合規 · 跨境財富管理平台
            </p>
          </div>

          <!-- 右邊 TSMC 風格四欄 -->
          <div class="tm-footer-cols">
            <div class="tm-footer-col">
              <h3 class="tm-footer-col-title" data-i18n="footer.solutionsTitle">解決方案</h3>
              <a href="#" class="tm-footer-link" data-i18n="footer.solution1">家族辦公室</a>
              <a href="#" class="tm-footer-link" data-i18n="footer.solution2">跨境客戶</a>
              <a href="#" class="tm-footer-link" data-i18n="footer.solution3">創業家</a>
              <a href="#" class="tm-footer-link" data-i18n="footer.solution4">退休規劃</a>
            </div>

            <div class="tm-footer-col">
              <h3 class="tm-footer-col-title" data-i18n="footer.platformTitle">平台</h3>
              <a href="#" class="tm-footer-link" data-i18n="footer.platform1">全球總覽</a>
              <a href="#" class="tm-footer-link" data-i18n="footer.platform2">稅務與合規</a>
              <a href="#" class="tm-footer-link" data-i18n="footer.platform3">資產傳承</a>
              <a href="#" class="tm-footer-link" data-i18n="footer.platform4">風險監控</a>
            </div>

            <div class="tm-footer-col">
              <h3 class="tm-footer-col-title" data-i18n="footer.resourcesTitle">資源</h3>
              <a href="#" class="tm-footer-link" data-i18n="footer.resource1">洞見</a>
              <a href="#" class="tm-footer-link" data-i18n="footer.resource2">產品更新</a>
              <a href="#" class="tm-footer-link" data-i18n="footer.resource3">合作夥伴計畫</a>
              <a href="#" class="tm-footer-link" data-i18n="footer.resource4">系統狀態</a>
            </div>

            <div class="tm-footer-col">
              <h3 class="tm-footer-col-title" data-i18n="footer.legalTitle">法律</h3>
              <a href="#" class="tm-footer-link" data-i18n="footer.legal1">隱私權政策</a>
              <a href="#" class="tm-footer-link" data-i18n="footer.legal2">服務條款</a>
              <a href="#" class="tm-footer-link" data-i18n="footer.legal3">資料處理</a>
              <a href="#" class="tm-footer-link" data-i18n="footer.legal4">次處理者</a>
            </div>
          </div>
        </div>

        <div class="tm-footer-bottom">
          <p class="tm-footer-copy" data-i18n="footer.copyright">
            © 2025 Taimic Inc. All Rights Reserved.
          </p>

          <div class="tm-footer-social">
            <a href="https://x.com" target="_blank" rel="noopener" aria-label="X">
              <i class="fa-brands fa-x-twitter"></i>
            </a>
            <a href="https://instagram.com" target="_blank" rel="noopener" aria-label="Instagram">
              <i class="fa-brands fa-instagram"></i>
            </a>
          </div>
        </div>
      </div>
    </footer>
  </div>

  <!-- ========== MODALS ========== -->

  <!-- OCR Modal -->
  <div id="ocr-modal" class="tm-modal-backdrop hidden">
    <div class="tm-modal">
      <div class="tm-modal-header">
        <h3 class="text-sm font-medium">新增台灣資產 (AI OCR)</h3>
        <span class="tm-modal-close" data-close="ocr-modal">&times;</span>
      </div>
      <div class="tm-modal-body text-sm">
        <p class="mb-3 text-slate-700">
          上傳保單首頁或銀行對帳單，AI 將自動辨識關鍵欄位並加入資產清單。
        </p>
        <button id="ocr-upload-btn" class="tm-primary-btn mb-3">
          <i class="fa-solid fa-cloud-arrow-up"></i>
          <span>點擊上傳檔案</span>
        </button>
        <div id="scan-log" class="text-xs font-mono text-emerald-700 h-16 overflow-y-auto"></div>
      </div>
    </div>
    <input id="ocr-file-input" type="file" class="hidden" />
  </div>

  <!-- Login Modal -->
  <div id="login-modal" class="tm-modal-backdrop hidden">
    <div class="tm-modal">
      <div class="tm-modal-header">
        <h3 class="text-sm font-medium">登入 TAIMIC 帳號</h3>
        <span class="tm-modal-close" data-close="login-modal">&times;</span>
      </div>
      <div class="tm-modal-body text-sm space-y-4">
        <div>
          <label class="block text-xs mb-1">Email</label>
          <input id="login-email" class="tm-input" type="email" placeholder="you@gmail.com" />
        </div>
        <div>
          <label class="block text-xs mb-1">密碼</label>
          <input id="login-password" class="tm-input" type="password" />
        </div>
        <div class="flex items-center justify-between text-xs">
          <span class="tm-link" id="open-reset-from-login">忘記密碼？</span>
        </div>
        <button id="login-submit" class="tm-primary-btn">
          <i class="fa-solid fa-arrow-right-to-bracket"></i>
          <span>登入</span>
        </button>
        <p id="login-message" class="text-xs text-emerald-700"></p>
      </div>
    </div>
  </div>

  <!-- Register Modal -->
  <div id="register-modal" class="tm-modal-backdrop hidden">
    <div class="tm-modal">
      <div class="tm-modal-header">
        <h3 class="text-sm font-medium">註冊 TAIMIC 帳號</h3>
        <span class="tm-modal-close" data-close="register-modal">&times;</span>
      </div>
      <div class="tm-modal-body text-sm space-y-4">
        <div>
          <label class="block text-xs mb-1">Email</label>
          <input id="register-email" class="tm-input" type="email" placeholder="you@gmail.com" />
        </div>
        <div>
          <label class="block text-xs mb-1">密碼</label>
          <input id="register-password" class="tm-input" type="password" placeholder="請輸入至少 6 碼密碼" />
        </div>
        <button id="register-submit" class="tm-primary-btn">
          <i class="fa-solid fa-user-plus"></i>
          <span>註冊</span>
        </button>
        <p id="register-message" class="text-xs text-emerald-700"></p>
      </div>
    </div>
  </div>

  <!-- Reset Password Modal (輸入 email) -->
  <div id="reset-request-modal" class="tm-modal-backdrop hidden">
    <div class="tm-modal">
      <div class="tm-modal-header">
        <h3 class="text-sm font-medium">忘記密碼</h3>
        <span class="tm-modal-close" data-close="reset-request-modal">&times;</span>
      </div>
      <div class="tm-modal-body text-sm space-y-4">
        <p class="text-slate-700 text-xs">
          輸入你註冊時使用的 email，系統會產生一組重設驗證碼 (demo：顯示在 Console)。
        </p>
        <div>
          <label class="block text-xs mb-1">Email</label>
          <input id="reset-email" class="tm-input" type="email" placeholder="you@gmail.com" />
        </div>
        <button id="reset-request-submit" class="tm-primary-btn">
          <i class="fa-solid fa-envelope"></i>
          <span>產生重設驗證碼</span>
        </button>
        <p id="reset-request-message" class="text-xs text-emerald-700"></p>
      </div>
    </div>
  </div>

  <!-- Reset Password Modal (輸入 token + 新密碼) -->
  <div id="reset-confirm-modal" class="tm-modal-backdrop hidden">
    <div class="tm-modal">
      <div class="tm-modal-header">
        <h3 class="text-sm font-medium">輸入驗證碼，設定新密碼</h3>
        <span class="tm-modal-close" data-close="reset-confirm-modal">&times;</span>
      </div>
      <div class="tm-modal-body text-sm space-y-4">
        <div>
          <label class="block text-xs mb-1">Email</label>
          <input id="reset-confirm-email" class="tm-input" type="email" placeholder="you@gmail.com" />
        </div>
        <div>
          <label class="block text-xs mb-1">驗證碼 (token)</label>
          <input id="reset-token" class="tm-input" type="text" />
        </div>
        <div>
          <label class="block text-xs mb-1">新密碼</label>
          <input id="reset-new-password" class="tm-input" type="password" />
        </div>
        <button id="reset-confirm-submit" class="tm-primary-btn">
          <i class="fa-solid fa-key"></i>
          <span>重設密碼</span>
        </button>
        <p id="reset-confirm-message" class="text-xs text-emerald-700"></p>
      </div>
    </div>
  </div>

  <!-- ========== SCRIPTS ========== -->
  <script>
    const API_BASE = "https://cool-cell-b227.amy20060226.workers.dev";

    /* ---------- Modal 控制 ---------- */
    function openModal(id) {
      document.getElementById(id)?.classList.remove("hidden");
    }
    function closeModal(id) {
      document.getElementById(id)?.classList.add("hidden");
    }
    document.querySelectorAll(".tm-modal-close").forEach((el) => {
      el.addEventListener("click", () => {
        const id = el.getAttribute("data-close");
        if (id) closeModal(id);
      });
    });

    // 點 backdrop 關閉
    ["ocr-modal", "login-modal", "register-modal", "reset-request-modal", "reset-confirm-modal"].forEach(
      (id) => {
        const backdrop = document.getElementById(id);
        if (!backdrop) return;
        backdrop.addEventListener("click", (e) => {
          if (e.target === backdrop) backdrop.classList.add("hidden");
        });
      }
    );

    /* ---------- 使用者選單 ---------- */
    const avatarBtn = document.getElementById("avatar-btn");
    const userMenu = document.getElementById("user-menu");

    avatarBtn.addEventListener("click", () => {
      userMenu.classList.toggle("hidden");
    });

    document.addEventListener("click", (e) => {
      if (!avatarBtn.contains(e.target) && !userMenu.contains(e.target)) {
        userMenu.classList.add("hidden");
      }
    });

    document.getElementById("menu-login").addEventListener("click", () => {
      userMenu.classList.add("hidden");
      openModal("login-modal");
    });
    document.getElementById("menu-register").addEventListener("click", () => {
      userMenu.classList.add("hidden");
      openModal("register-modal");
    });

    /* ---------- OCR / AI Scan Demo ---------- */
    const ocrModal = document.getElementById("ocr-modal");
    document.getElementById("open-ocr").addEventListener("click", () =>
      openModal("ocr-modal")
    );
    document.getElementById("ocr-upload-btn").addEventListener("click", () => {
      document.getElementById("ocr-file-input").click();
    });

    let scanLog = document.getElementById("scan-log");
    function startScanDemo() {
      scanLog.innerHTML = "";
      setTimeout(() => {
        scanLog.innerHTML += "&gt; Detecting Language: zh-TW<br/>";
      }, 500);
      setTimeout(() => {
        scanLog.innerHTML += '&gt; Parsing: "富邦人壽 (Fubon Life)"<br/>';
      }, 1200);
      setTimeout(() => {
        scanLog.innerHTML += "&gt; Match IRS Code: 8938<br/>";
        // Demo: 加一筆資產
        assets.unshift({
          id: Date.now(),
          name: { en: "Fubon Life (Whole Life)", zh: "富邦人壽 (終身壽險)" },
          type: { en: "Insurance", zh: "儲蓄險" },
          region: "TW",
          usd: 52000,
          new: true,
        });
        renderAssets();
        saveAssetsToWorker();
      }, 2000);
    }

    document
      .getElementById("ocr-file-input")
      .addEventListener("change", (e) => {
        if (e.target.files.length > 0) {
          startScanDemo();
        }
      });

    /* ---------- 資產 / Chart ---------- */
    let assets = [
      {
        id: 1,
        name: { en: "Fubon Life (Whole Life)", zh: "富邦人壽 (終身壽險)" },
        type: { en: "Insurance", zh: "儲蓄險" },
        region: "TW",
        usd: 1690000,
      },
      {
        id: 2,
        name: { en: "US Brokerage", zh: "美國券商帳戶" },
        type: { en: "Securities", zh: "證券" },
        region: "US",
        usd: 1540000,
      },
    ];

    let chart;

    function renderAssets() {
      const tbody = document.getElementById("assets-body");
      tbody.innerHTML = "";
      assets.forEach((a) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td class="py-2 text-slate-800">${a.name.zh}</td>
          <td class="py-2">${a.region}</td>
          <td class="py-2">${a.type.zh}</td>
          <td class="py-2 text-right">$${a.usd.toLocaleString()}</td>
        `;
        tbody.appendChild(tr);
      });
      updateChart();
    }

    function updateChart() {
      const ctx = document.getElementById("asset-chart").getContext("2d");
      const regionMap = {};
      assets.forEach((a) => {
        regionMap[a.region] = (regionMap[a.region] || 0) + a.usd;
      });
      const labels = Object.keys(regionMap);
      const data = Object.values(regionMap);
      if (chart) {
        chart.data.labels = labels;
        chart.data.datasets[0].data = data;
        chart.update();
      } else {
        chart = new Chart(ctx, {
          type: "doughnut",
          data: {
            labels,
            datasets: [
              {
                data,
                backgroundColor: ["#2563eb", "#16a34a", "#f97316", "#6366f1"],
              },
            ],
          },
          options: {
            plugins: {
              legend: { position: "bottom" },
            },
          },
        });
      }
    }

    async function loadAssetsFromWorker() {
      try {
        const res = await fetch(`${API_BASE}/api/assets`);
        if (res.ok) {
          const data = await res.json();
          if (data.assets && Array.isArray(data.assets)) {
            assets = data.assets;
          }
        }
      } catch (err) {
        console.warn("load assets error, use local demo:", err);
      } finally {
        renderAssets();
      }
    }

    async function saveAssetsToWorker() {
      try {
        const res = await fetch(`${API_BASE}/api/save-assets`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ assets }),
        });
        console.log("save-assets response from worker:", await res.json());
      } catch (err) {
        console.error("save-assets error:", err);
      }
    }

    /* ---------- 登入 / 註冊 / 重設密碼 ---------- */
    async function register(email, password) {
      const res = await fetch(`${API_BASE}/api/register`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email, password }),
      });
      return res.json();
    }

    async function login(email, password) {
      const res = await fetch(`${API_BASE}/api/login`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email, password }),
      });
      return res.json();
    }

    async function requestReset(email) {
      const res = await fetch(`${API_BASE}/api/request-reset`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email }),
      });
      return res.json();
    }

    async function resetPassword(email, token, newPassword) {
      const res = await fetch(`${API_BASE}/api/reset-password`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email, token, newPassword }),
      });
      return res.json();
    }

    document
      .getElementById("register-submit")
      .addEventListener("click", async () => {
        const email = document.getElementById("register-email").value.trim();
        const password = document
          .getElementById("register-password")
          .value.trim();
        const msgEl = document.getElementById("register-message");
        msgEl.textContent = "";
        if (!email || !password || password.length < 6) {
          msgEl.textContent = "請輸入有效的 email 與至少 6 碼密碼。";
          msgEl.classList.remove("text-emerald-700");
          msgEl.classList.add("text-red-600");
          return;
        }
        try {
          const data = await register(email, password);
          if (data.ok) {
            msgEl.textContent = "註冊成功，請使用帳號登入。";
            msgEl.classList.remove("text-red-600");
            msgEl.classList.add("text-emerald-700");
          } else {
            msgEl.textContent = data.message || "註冊失敗。";
            msgEl.classList.remove("text-emerald-700");
            msgEl.classList.add("text-red-600");
          }
        } catch (err) {
          msgEl.textContent = "系統錯誤，請稍後再試。";
          msgEl.classList.remove("text-emerald-700");
          msgEl.classList.add("text-red-600");
        }
      });

    document
      .getElementById("login-submit")
      .addEventListener("click", async () => {
        const email = document.getElementById("login-email").value.trim();
        const password = document
          .getElementById("login-password")
          .value.trim();
        const msgEl = document.getElementById("login-message");
        msgEl.textContent = "";
        if (!email || !password) {
          msgEl.textContent = "請輸入 email 與密碼。";
          msgEl.classList.remove("text-emerald-700");
          msgEl.classList.add("text-red-600");
          return;
        }
        try {
          const data = await login(email, password);
          if (data.ok) {
            // 登入成功訊息：只顯示「登入成功」
            msgEl.textContent = "登入成功";
            msgEl.classList.remove("text-red-600");
            msgEl.classList.add("text-emerald-700");
            localStorage.setItem("taimic_user_email", email);
            setTimeout(() => closeModal("login-modal"), 800);
          } else {
            msgEl.textContent = data.message || "帳號或密碼錯誤。";
            msgEl.classList.remove("text-emerald-700");
            msgEl.classList.add("text-red-600");
          }
        } catch (err) {
          msgEl.textContent = "系統錯誤，請稍後再試。";
          msgEl.classList.remove("text-emerald-700");
          msgEl.classList.add("text-red-600");
        }
      });

    // 開啟 reset flow
    document
      .getElementById("open-reset-from-login")
      .addEventListener("click", () => {
        closeModal("login-modal");
        openModal("reset-request-modal");
      });

    document
      .getElementById("reset-request-submit")
      .addEventListener("click", async () => {
        const email = document.getElementById("reset-email").value.trim();
        const msgEl = document.getElementById("reset-request-message");
        msgEl.textContent = "";
        if (!email) {
          msgEl.textContent = "請輸入 email。";
          msgEl.classList.remove("text-emerald-700");
          msgEl.classList.add("text-red-600");
          return;
        }
        try {
          const data = await requestReset(email);
          if (data.ok) {
            console.log("resetToken for", email, "=>", data.token);
            msgEl.textContent = "已產生驗證碼，請到 Console 查看 token。";
            msgEl.classList.remove("text-red-600");
            msgEl.classList.add("text-emerald-700");
            // 幫你自動帶 email 到下一個 modal
            document.getElementById("reset-confirm-email").value = email;
            setTimeout(() => {
              closeModal("reset-request-modal");
              openModal("reset-confirm-modal");
            }, 800);
          } else {
            msgEl.textContent = data.message || "產生驗證碼失敗。";
            msgEl.classList.remove("text-emerald-700");
            msgEl.classList.add("text-red-600");
          }
        } catch (err) {
          msgEl.textContent = "系統錯誤，請稍後再試。";
          msgEl.classList.remove("text-emerald-700");
          msgEl.classList.add("text-red-600");
        }
      });

    document
      .getElementById("reset-confirm-submit")
      .addEventListener("click", async () => {
        const email = document
          .getElementById("reset-confirm-email")
          .value.trim();
        const token = document.getElementById("reset-token").value.trim();
        const newPassword = document
          .getElementById("reset-new-password")
          .value.trim();
        const msgEl = document.getElementById("reset-confirm-message");
        msgEl.textContent = "";
        if (!email || !token || !newPassword) {
          msgEl.textContent = "請完整輸入 email、驗證碼與新密碼。";
          msgEl.classList.remove("text-emerald-700");
          msgEl.classList.add("text-red-600");
          return;
        }
        try {
          const data = await resetPassword(email, token, newPassword);
          if (data.ok) {
            msgEl.textContent = "密碼已重設，請使用新密碼登入。";
            msgEl.classList.remove("text-red-600");
            msgEl.classList.add("text-emerald-700");
          } else {
            msgEl.textContent = data.message || "驗證碼錯誤或已失效。";
            msgEl.classList.remove("text-emerald-700");
            msgEl.classList.add("text-red-600");
          }
        } catch (err) {
          msgEl.textContent = "系統錯誤，請稍後再試。";
          msgEl.classList.remove("text-emerald-700");
          msgEl.classList.add("text-red-600");
        }
      });

    /* ---------- 語言切換 ---------- */
    let currentLang = "zh";

    const translations = {
      zh: {
        "menu.login": "登入",
        "menu.register": "註冊",
        "footer.tagline": "FATCA / CRS 合規 · 跨境財富管理平台",
        "footer.solutionsTitle": "解決方案",
        "footer.solution1": "家族辦公室",
        "footer.solution2": "跨境客戶",
        "footer.solution3": "創業家",
        "footer.solution4": "退休規劃",
        "footer.platformTitle": "平台",
        "footer.platform1": "全球總覽",
        "footer.platform2": "稅務與合規",
        "footer.platform3": "資產傳承",
        "footer.platform4": "風險監控",
        "footer.resourcesTitle": "資源",
        "footer.resource1": "洞見",
        "footer.resource2": "產品更新",
        "footer.resource3": "合作夥伴計畫",
        "footer.resource4": "系統狀態",
        "footer.legalTitle": "法律",
        "footer.legal1": "隱私權政策",
        "footer.legal2": "服務條款",
        "footer.legal3": "資料處理",
        "footer.legal4": "次處理者",
        "footer.copyright": "© 2025 Taimic Inc. All Rights Reserved.",
      },
      en: {
        "menu.login": "Log in",
        "menu.register": "Sign up",
        "footer.tagline": "FATCA / CRS Compliant · Cross-Border Wealth Platform",
        "footer.solutionsTitle": "Solutions",
        "footer.solution1": "Family Office",
        "footer.solution2": "Cross-Border Clients",
        "footer.solution3": "Entrepreneurs",
        "footer.solution4": "Retirement",
        "footer.platformTitle": "Platform",
        "footer.platform1": "Global Dashboard",
        "footer.platform2": "Tax & Compliance",
        "footer.platform3": "Estate Planning",
        "footer.platform4": "Risk Monitoring",
        "footer.resourcesTitle": "Resources",
        "footer.resource1": "Insights",
        "footer.resource2": "Product Updates",
        "footer.resource3": "Partner Program",
        "footer.resource4": "Status",
        "footer.legalTitle": "Legal",
        "footer.legal1": "Privacy Policy",
        "footer.legal2": "Terms of Service",
        "footer.legal3": "Data Processing",
        "footer.legal4": "Subprocessors",
        "footer.copyright": "© 2025 Taimic Inc. All Rights Reserved.",
      },
    };

    function applyLang(lang) {
      currentLang = lang;
      document.querySelectorAll("[data-i18n]").forEach((el) => {
        const key = el.getAttribute("data-i18n");
        const text = translations[lang][key];
        if (text) el.textContent = text;
      });
    }

    document.getElementById("lang-toggle").addEventListener("click", () => {
      applyLang(currentLang === "zh" ? "en" : "zh");
    });

    /* ---------- 初始化 ---------- */
    window.addEventListener("DOMContentLoaded", () => {
      applyLang("zh");
      loadAssetsFromWorker();
    });
  </script>
</body>
</html>
