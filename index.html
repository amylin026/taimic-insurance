<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TAIMIC | Global Wealth Management</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">

  <style>
    /* --- CSS Variables & Base Styles --- */
    :root {
      --primary-color: #0066cc;
      --primary-dark: #004c99;
      --bg-light: #f3f5f9;
      --text-main: #111827;
      --card-shadow: 0 6px 18px rgba(15, 23, 42, 0.04);
    }

    body {
      font-family: 'Inter', 'Noto Sans TC', sans-serif;
      background-color: var(--bg-light);
      color: #333;
      -webkit-font-smoothing: antialiased;
    }

    /* Custom Components */
    .panel {
      background: white;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      box-shadow: var(--card-shadow);
    }

    .nav-link {
      font-size: 15px; 
      font-weight: 500; 
      color: #666;
      padding: 0 20px; 
      height: 80px; 
      display: flex; 
      align-items: center;
      border-bottom: 4px solid transparent; 
      transition: color 0.2s, border-bottom 0.2s;
      text-decoration: none;
    }
    .nav-link:hover { color: var(--primary-color); }
    .nav-link.active { 
      color: var(--text-main); 
      font-weight: 700; 
      border-bottom-color: var(--primary-color); 
    }

    .btn-primary {
      background-color: var(--primary-color);
      color: white;
      font-weight: 600;
      padding: 10px 24px;
      border-radius: 9999px;
      transition: all 0.2s ease;
    }
    .btn-primary:hover {
      background-color: var(--primary-dark);
      transform: translateY(-1px);
    }

    /* Dropdown Styles */
    .dropdown-wrapper { position: relative; height: 100%; display: flex; align-items: center; }
    .dropdown-menu {
      position: absolute;
      top: 70px;
      right: 0;
      background: white;
      border: 1px solid #e5e7eb;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      min-width: 180px;
      z-index: 50;
      border-radius: 12px;
      padding: 6px 0;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: all 0.2s ease;
    }
    .dropdown-menu.show {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }
    
    .dropdown-item {
      padding: 10px 18px;
      font-size: 14px;
      color: #4b5563;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .dropdown-item:hover { background-color: #f3f4ff; color: var(--primary-color); }
    .dropdown-item.selected { color: var(--primary-color); background-color: #eef2ff; font-weight: 700; }

    /* Clock Animation */
    .clock-tick-line { stroke: #cbd5f5; stroke-width: 1.4; stroke-linecap: round; }
    .hand { stroke-width: 2.6; stroke-linecap: round; transform-origin: 50% 50%; }
    .hand-hour { stroke: #1f2933; animation: rotate 1800s linear infinite; }
    .hand-minute { stroke: #3b82f6; animation: rotate 300s linear infinite; }
    @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

    /* Scanner Animation */
    .scan-line {
      background: linear-gradient(to bottom, transparent, rgba(0, 102, 204, 0.2), transparent);
      animation: scanMove 2s linear infinite;
    }
    @keyframes scanMove { 0% { transform: translateY(-100%); } 100% { transform: translateY(100%); } }
    
    .fade-in-up { animation: fadeInUp 0.4s ease-out forwards; }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
  </style>
</head>

<body class="flex flex-col min-h-screen">

  <header class="bg-white border-b border-gray-200 sticky top-0 z-40 shadow-sm h-[80px]">
    <div class="max-w-screen-2xl mx-auto px-6 h-full flex justify-between items-center">
      
      <div class="flex items-center gap-4 cursor-pointer select-none">
        <svg width="44" height="44" viewBox="0 0 100 100">
          <defs>
            <linearGradient id="clockGradient" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0%" stop-color="#bfdbfe" />
              <stop offset="100%" stop-color="#60a5fa" />
            </linearGradient>
          </defs>
          <circle cx="50" cy="50" r="46" fill="none" stroke="#dbeafe" stroke-width="2.5" />
          <circle cx="50" cy="50" r="38" fill="#eff6ff" stroke="#e5edff" stroke-width="1.5" />
          <circle cx="50" cy="50" r="30" fill="url(#clockGradient)" opacity="0.98" />
          <line x1="50" y1="12" x2="50" y2="18" class="clock-tick-line" />
          <line x1="88" y1="50" x2="82" y2="50" class="clock-tick-line" />
          <line x1="50" y1="82" x2="50" y2="88" class="clock-tick-line" />
          <line x1="18" y1="50" x2="12" y2="50" class="clock-tick-line" />
          <line x1="50" y1="50" x2="50" y2="30" class="hand hand-hour" />
          <line x1="50" y1="50" x2="66" y2="34" class="hand hand-minute" />
          <circle cx="50" cy="50" r="3.2" fill="#fff" stroke="#3b82f6" stroke-width="2" />
        </svg>
        <div class="flex flex-col justify-center">
          <span class="text-[22px] font-bold text-[#0066cc] leading-none tracking-tight">TAIMIC</span>
          <span class="text-[10px] font-semibold tracking-[0.2em] text-gray-500 mt-1 uppercase">Global Wealth</span>
        </div>
      </div>

      <nav class="hidden lg:flex h-full items-center space-x-4">
        <a href="#" class="nav-link active" data-i18n="nav.overview">è³‡ç”¢ç¸½è¦½</a>
        <a href="#" class="nav-link" data-i18n="nav.tax">ç¨…å‹™åˆè¦</a>
        <a href="#" class="nav-link" data-i18n="nav.estate">å®¶æ—å‚³æ‰¿</a>
        <a href="#" class="nav-link" data-i18n="nav.reports">åˆ†æå ±å‘Š</a>
      </nav>

      <div class="flex items-center gap-6 h-full">
        <div class="hidden sm:flex items-center text-xs font-medium border border-gray-200 rounded-full overflow-hidden bg-gray-50">
          <button class="currency-btn px-4 py-2 transition-colors" data-currency="USD">USD</button>
          <button class="currency-btn px-4 py-2 transition-colors" data-currency="TWD">TWD</button>
        </div>

        <div class="dropdown-wrapper cursor-pointer" id="lang-wrapper">
          <button class="flex items-center gap-2 text-gray-600 hover:text-[#0066cc] transition-colors">
            <div class="w-9 h-9 rounded-full flex items-center justify-center bg-gray-50 border border-gray-200">
              <i class="fa-solid fa-globe text-sm"></i>
            </div>
            <i class="fa-solid fa-caret-down text-xs"></i>
          </button>
          <div class="dropdown-menu" id="lang-menu">
            <div class="dropdown-item" data-lang="zh">ç¹é«”ä¸­æ–‡</div>
            <div class="dropdown-item" data-lang="en">English</div>
          </div>
        </div>

        <div class="dropdown-wrapper cursor-pointer pl-4 border-l border-gray-200" id="user-wrapper">
          <button class="w-10 h-10 bg-gray-100 text-gray-600 rounded-full flex items-center justify-center hover:bg-[#0066cc] hover:text-white transition-colors">
            <i class="fa-solid fa-user text-base"></i>
          </button>
          <div class="dropdown-menu" id="user-menu">
            <div class="dropdown-item" data-action="login">
              <i class="fa-solid fa-right-to-bracket"></i> <span data-i18n="user.login">ç™»å…¥</span>
            </div>
            <div class="dropdown-item" data-action="register">
              <i class="fa-solid fa-user-plus"></i> <span data-i18n="user.register">è¨»å†Š</span>
            </div>
            <div class="border-t border-gray-100 my-1"></div>
            <div class="dropdown-item">
              <i class="fa-solid fa-circle-question"></i> <span>Help</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <section class="border-b border-gray-200 bg-[#e5ebf5]">
    <div class="max-w-screen-2xl mx-auto px-6 py-8 md:py-10">
      <div class="panel px-8 py-8 md:px-10 md:py-9 flex flex-col md:flex-row md:items-center md:justify-between gap-8">
        <div>
          <div class="text-xs font-bold text-gray-400 uppercase tracking-[0.2em] mb-2">Global Asset Management / Dashboard</div>
          <h1 class="text-2xl md:text-3xl font-bold text-gray-900 mb-3" data-i18n="page.title">è·¨åœ‹è³‡ç”¢æ•´åˆå¹³å°</h1>
          <p class="text-gray-600 text-sm md:text-base max-w-2xl leading-relaxed" data-i18n="page.desc">
            æ•´åˆå°ç£èˆ‡ç¾åœ‹è³‡ç”¢ï¼Œæä¾›å³æ™‚æ·¨å€¼åˆ†æèˆ‡è·¨å¢ƒç¨…å‹™é¢¨éšªæª¢æ¸¬ã€‚
          </p>
        </div>
        <div class="flex flex-col items-start md:items-end gap-3">
          <button id="btn-upload-modal" class="btn-primary flex items-center gap-2 shadow-sm">
            <i class="fa-solid fa-plus"></i> <span data-i18n="btn.add">æ–°å¢è³‡ç”¢</span>
          </button>
          <div class="text-[11px] text-gray-500 flex items-center gap-2">
            <i class="fa-solid fa-shield-halved text-[#0066cc]"></i>
            <span>FATCA / CRS Risk Scanner Active</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <main class="flex-grow py-10">
    <div class="max-w-screen-2xl mx-auto px-6">
      <div class="panel px-6 md:px-8 lg:px-10 py-8">
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
          <div class="p-6 border border-gray-200 rounded-xl hover:border-blue-600 transition-colors">
            <div class="flex justify-between items-start mb-4">
              <h3 class="text-xs font-bold text-gray-500 uppercase tracking-widest" data-i18n="stat.us">ç¾åœ‹ç¸½è³‡ç”¢</h3>
              <span class="text-xl">ğŸ‡ºğŸ‡¸</span>
            </div>
            <div class="text-3xl font-bold font-mono tracking-tight currency-display" data-value="482500">--</div>
            <div class="mt-2 text-xs font-medium text-green-600 flex items-center gap-1">
              <i class="fa-solid fa-arrow-trend-up"></i> +4.2% YTD
            </div>
          </div>

          <div class="p-6 border border-gray-200 rounded-xl hover:border-blue-600 transition-colors">
            <div class="flex justify-between items-start mb-4">
              <h3 class="text-xs font-bold text-gray-500 uppercase tracking-widest" data-i18n="stat.tw">å°ç£ç¸½è³‡ç”¢</h3>
              <span class="text-xl">ğŸ‡¹ğŸ‡¼</span>
            </div>
            <div id="kpi-tw" class="text-3xl font-bold font-mono tracking-tight currency-display" data-value="315200">--</div>
            <div class="mt-2 text-xs font-medium text-green-600 flex items-center gap-1">
              <i class="fa-solid fa-arrow-trend-up"></i> +1.8% YTD
            </div>
          </div>

          <div class="p-6 bg-blue-50 border border-blue-100 rounded-xl">
            <div class="flex justify-between items-start mb-4">
              <h3 class="text-xs font-bold text-[#0066cc] uppercase tracking-widest" data-i18n="stat.global">å…¨çƒç¸½æ·¨å€¼</h3>
              <i class="fa-solid fa-globe text-[#0066cc]"></i>
            </div>
            <div id="kpi-global" class="text-3xl font-bold text-[#0066cc] font-mono tracking-tight currency-display" data-value="797700">--</div>
            <div class="mt-2 text-xs font-medium text-gray-600 flex items-center gap-1">
              <i class="fa-solid fa-shield-check text-[#0066cc]"></i>
              <span data-i18n="stat.safe">éºç”¢ç¨…é¢¨éšªï¼šå®‰å…¨</span>
            </div>
          </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-10">
          
          <div class="lg:col-span-2">
            <div id="risk-alert" class="hidden mb-8 bg-orange-50 border-l-4 border-orange-500 rounded-r-lg p-5 flex gap-4 fade-in-up">
              <div class="text-orange-500 pt-1"><i class="fa-solid fa-triangle-exclamation text-lg"></i></div>
              <div>
                <h4 class="font-bold text-gray-900 text-sm mb-1" data-i18n="alert.title">AI ç¨…å‹™è­¦ç¤ºï¼šåµæ¸¬åˆ°æ½›åœ¨ç”³å ±é¢¨éšª</h4>
                <p class="text-sm text-gray-700 leading-relaxed" data-i18n="alert.desc">ç³»çµ±æƒæç™¼ç¾ä¸€ç­†æ–°å¢çš„ã€Œé«˜ç¾é‡‘åƒ¹å€¼ä¿å–®ï¼ˆå°ç£ï¼‰ã€ã€‚æ ¹æ“šç¾åœ‹ IRS è¦ç¯„ï¼Œæ­¤è³‡ç”¢å¯èƒ½éœ€å¡«å¯« Form 8938ã€‚</p>
                <button class="mt-3 text-xs font-bold text-[#0066cc] uppercase hover:underline">æª¢è¦–è©³ç´°å ±å‘Š &rarr;</button>
              </div>
            </div>

            <div class="flex justify-between items-end mb-4 pb-2 border-b border-gray-200">
              <h3 class="text-lg font-bold text-gray-900" data-i18n="table.title">è³‡ç”¢æŒæœ‰æ¸…å–®</h3>
              <button class="text-xs text-[#0066cc] font-bold uppercase flex items-center gap-1 hover:text-blue-800">
                <i class="fa-solid fa-file-export"></i> Export
              </button>
            </div>

            <div class="overflow-x-auto">
              <table class="w-full text-left text-sm">
                <thead>
                  <tr class="text-xs text-gray-500 uppercase tracking-wider">
                    <th class="pl-2 pb-3 border-b-2 border-gray-100" data-i18n="col.name">è³‡ç”¢åç¨±</th>
                    <th class="pb-3 border-b-2 border-gray-100" data-i18n="col.region">åœ°å€</th>
                    <th class="pb-3 border-b-2 border-gray-100" data-i18n="col.type">é¡åˆ¥</th>
                    <th class="pr-2 pb-3 border-b-2 border-gray-100 text-right" data-i18n="col.val">ç¾å€¼</th>
                  </tr>
                </thead>
                <tbody id="asset-table-body">
                  </tbody>
              </table>
            </div>
          </div>

          <div class="space-y-8">
            <div class="border border-gray-200 rounded-xl p-6 bg-white shadow-sm">
              <h3 class="text-xs font-bold text-gray-500 uppercase mb-5 tracking-widest" data-i18n="chart.title">å€åŸŸé…ç½®åˆ†æ</h3>
              <div class="h-64 relative">
                <canvas id="allocationChart"></canvas>
                <div class="absolute inset-0 flex items-center justify-center pointer-events-none pb-4">
                  <div class="text-center">
                    <div class="text-[10px] text-gray-400 font-bold uppercase">Total Allocation</div>
                    <div class="text-sm font-bold text-gray-900">100%</div>
                  </div>
                </div>
              </div>
              <div class="bg-blue-50 p-4 rounded-lg border border-blue-100 mt-4">
                <div class="text-[10px] font-bold text-[#0066cc] mb-1 uppercase flex items-center gap-1">
                  <i class="fa-solid fa-robot"></i> <span data-i18n="chart.insight">AI Insight</span>
                </div>
                <p class="text-xs text-gray-700 leading-relaxed" data-i18n="chart.desc">
                  æ‚¨çš„å°ç£è³‡ç”¢ä½”ç¸½æ·¨å€¼çš„ 40%ã€‚å»ºè­°é‡å°å°å¹£åŒ¯ç‡é¢¨éšªé€²è¡Œé¿éšªã€‚
                </p>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </main>

  <footer class="bg-white border-t border-gray-200 py-8">
    <div class="max-w-screen-2xl mx-auto px-6 flex flex-col md:flex-row items-center justify-between text-xs text-gray-500">
      <div>Â© 2025 TAIMIC Inc. All rights reserved.</div>
      <div class="flex gap-4 mt-4 md:mt-0">
        <a href="#" class="hover:text-[#0066cc]">Privacy Policy</a>
        <a href="#" class="hover:text-[#0066cc]">Terms of Service</a>
        <a href="#" class="hover:text-[#0066cc]">Contact Support</a>
      </div>
    </div>
  </footer>

  <div id="modal-upload" class="fixed inset-0 bg-gray-900/60 backdrop-blur-sm z-50 hidden items-center justify-center p-4 opacity-0 transition-opacity duration-300">
    <div class="bg-white w-full max-w-md shadow-2xl rounded-xl overflow-hidden transform scale-95 transition-transform duration-300">
      <div class="bg-[#0066cc] p-4 flex justify-between items-center text-white">
        <h3 class="font-bold text-sm tracking-wide" data-i18n="modal.title">æ–°å¢å°ç£è³‡ç”¢ (AI OCR)</h3>
        <button class="modal-close hover:opacity-80"><i class="fa-solid fa-xmark text-lg"></i></button>
      </div>
      
      <div id="upload-step-initial" class="p-8 text-center">
        <div class="w-16 h-16 bg-blue-50 rounded-full flex items-center justify-center mx-auto mb-4 text-[#0066cc]">
          <i class="fa-solid fa-cloud-arrow-up text-2xl"></i>
        </div>
        <p class="text-sm text-gray-600 mb-6" data-i18n="modal.desc">ä¸Šå‚³ä¿å–®é¦–é æˆ–éŠ€è¡Œå°å¸³å–®ï¼ŒAI å°‡è‡ªå‹•æå–é—œéµæ•¸æ“šã€‚</p>
        <button id="btn-trigger-scan" class="w-full border-2 border-dashed border-gray-300 py-4 rounded-xl hover:border-[#0066cc] hover:bg-blue-50 transition-all text-gray-500 hover:text-[#0066cc] font-bold text-sm">
          <span data-i18n="btn.upload">é»æ“Šä¸Šå‚³æª”æ¡ˆ</span>
        </button>
      </div>

      <div id="upload-step-processing" class="hidden relative h-64 bg-[#0f172a] flex flex-col items-center justify-center">
        <div class="scan-line absolute inset-0"></div>
        <div class="z-10 text-center w-full px-8">
          <p class="text-white font-mono text-sm mb-3" data-i18n="modal.scanning">AI Analyzing...</p>
          <div class="w-full h-1 bg-gray-700 rounded overflow-hidden mb-4">
            <div id="progress-bar" class="h-full bg-blue-500 w-0 transition-all duration-300 ease-out"></div>
          </div>
          <div id="scan-console" class="text-[10px] text-green-400 font-mono h-16 text-left overflow-hidden opacity-80"></div>
        </div>
      </div>
    </div>
  </div>

  <div id="modal-auth" class="fixed inset-0 bg-gray-900/60 backdrop-blur-sm z-50 hidden items-center justify-center p-4">
    <div class="bg-white w-full max-w-lg rounded-xl shadow-2xl overflow-hidden">
      <div class="bg-blue-700 px-6 py-4 flex items-center justify-between text-white">
        <h3 id="auth-title" class="font-bold">Account Access</h3>
        <button class="modal-close hover:opacity-80"><i class="fa-solid fa-xmark text-xl"></i></button>
      </div>
      <form id="auth-form" class="px-8 py-8 space-y-5">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
          <input type="email" id="auth-email" required class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none" placeholder="name@company.com" />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
          <input type="password" id="auth-password" required class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none" />
        </div>
        <div id="auth-feedback" class="text-sm h-5 text-center text-red-500"></div>
        <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold text-sm py-3 rounded-full transition-colors">
          Submit
        </button>
      </form>
    </div>
  </div>

  <script>
    /**
     * Application Config & State
     */
    const APP_CONFIG = {
      apiBase: "https://cool-cell-b227.amy20060226.workers.dev",
      exchangeRate: 32.5
    };

    const state = {
      currency: 'TWD',
      lang: 'zh',
      user: null,
      assets: [
        { id: 1, name: {en:'Vanguard Total Stock (VTI)', zh:'Vanguard å…¨çƒè‚¡ç¥¨ ETF (VTI)'}, type: {en:'ETF', zh:'æŒ‡æ•¸å‹åŸºé‡‘'}, region:'US', valueUsd: 145200 },
        { id: 2, name: {en:'Taipei Xinyi Condo', zh:'å°åŒ—ä¿¡ç¾©å€å…¬å¯“'}, type: {en:'Real Estate', zh:'æˆ¿åœ°ç”¢'}, region:'TW', valueUsd: 280000 },
        { id: 3, name: {en:'Fidelity 401(k)', zh:'å¯Œé”é€€ä¼‘é‡‘ 401(k)'}, type: {en:'Retirement', zh:'é€€ä¼‘é‡‘'}, region:'US', valueUsd: 98500 },
      ]
    };

    const DICTIONARY = {
      en: {
        'nav.overview':'Overview', 'nav.tax':'Tax & Compliance', 'nav.estate':'Estate Plan', 'nav.reports':'Reports',
        'page.title':'Cross-Border Wealth Platform', 'page.desc':'Integrated view of Taiwan & US assets with FATCA compliance checks.',
        'btn.add':'Add Asset', 'btn.upload':'Click to Upload File',
        'stat.us':'US Net Worth', 'stat.tw':'Taiwan Net Worth', 'stat.global':'Global Total', 'stat.safe':'Estate Tax Risk: Safe',
        'table.title':'Portfolio Holdings', 'col.name':'Asset Name', 'col.region':'Region', 'col.type':'Category', 'col.val':'Value',
        'alert.title':'AI Tax Alert: FATCA Risk Detected', 'alert.desc':'Detected a new "High Cash Value" insurance policy in Taiwan. Exceeds $50k reporting threshold.',
        'chart.title':'Regional Allocation', 'chart.insight':'AI Insight', 'chart.desc':'Your Taiwan assets comprise 40% of your net worth. Consider hedging TWD currency risk.',
        'modal.title':'Add Taiwan Asset (AI OCR)', 'modal.desc':'Upload policy or statement. AI will extract data.', 'modal.scanning':'AI Analyzing...',
        'user.login':'Login', 'user.register':'Register'
      },
      zh: {
        'nav.overview':'è³‡ç”¢ç¸½è¦½', 'nav.tax':'ç¨…å‹™åˆè¦', 'nav.estate':'å®¶æ—å‚³æ‰¿', 'nav.reports':'åˆ†æå ±å‘Š',
        'page.title':'è·¨åœ‹è³‡ç”¢æ•´åˆå¹³å°', 'page.desc':'æ•´åˆå°ç£èˆ‡ç¾åœ‹è³‡ç”¢ï¼Œæä¾›å³æ™‚æ·¨å€¼åˆ†æèˆ‡è·¨å¢ƒç¨…å‹™é¢¨éšªæª¢æ¸¬ã€‚',
        'btn.add':'æ–°å¢è³‡ç”¢', 'btn.upload':'é»æ“Šä¸Šå‚³æª”æ¡ˆ',
        'stat.us':'ç¾åœ‹ç¸½è³‡ç”¢', 'stat.tw':'å°ç£ç¸½è³‡ç”¢', 'stat.global':'å…¨çƒç¸½æ·¨å€¼', 'stat.safe':'éºç”¢ç¨…é¢¨éšªï¼šå®‰å…¨',
        'table.title':'è³‡ç”¢æŒæœ‰æ¸…å–®', 'col.name':'è³‡ç”¢åç¨±', 'col.region':'åœ°å€', 'col.type':'é¡åˆ¥', 'col.val':'ç¾å€¼',
        'alert.title':'AI ç¨…å‹™è­¦ç¤ºï¼šåµæ¸¬åˆ° FATCA é¢¨éšª', 'alert.desc':'ç³»çµ±æƒæåˆ°ä¸€å¼µæ–°å¢çš„å°ç£é«˜ç¾é‡‘åƒ¹å€¼ä¿å–®ã€‚æ­¤é‡‘é¡å·²è¶…é IRS Form 8938 çš„ 5 è¬ç¾å…ƒç”³å ±é–€æª»ã€‚',
        'chart.title':'å€åŸŸè³‡ç”¢é…ç½®', 'chart.insight':'AI æ™ºèƒ½åˆ†æ', 'chart.desc':'æ‚¨çš„å°ç£è³‡ç”¢ä½”ç¸½æ·¨å€¼çš„ 40%ã€‚å»ºè­°é‡å°å°å¹£åŒ¯ç‡é¢¨éšªé€²è¡Œé¿éšªã€‚',
        'modal.title':'æ–°å¢å°ç£è³‡ç”¢ (AI OCR)', 'modal.desc':'ä¸Šå‚³ä¿å–®é¦–é æˆ–éŠ€è¡Œå°å¸³å–®ï¼ŒAI å°‡è‡ªå‹•æå–é—œéµæ•¸æ“šã€‚', 'modal.scanning':'AI åˆ†æä¸­...',
        'user.login':'ç™»å…¥', 'user.register':'è¨»å†Š'
      }
    };

    let chartInstance = null;

    /**
     * Core Functions
     */
    function formatCurrency(amountUsd) {
      const isUsd = state.currency === 'USD';
      const val = isUsd ? amountUsd : amountUsd * APP_CONFIG.exchangeRate;
      return new Intl.NumberFormat(isUsd ? 'en-US' : 'zh-TW', {
        style: 'currency',
        currency: state.currency,
        maximumFractionDigits: 0
      }).format(val);
    }

    function renderUI() {
      // 1. Text I18n
      const dict = DICTIONARY[state.lang];
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.dataset.i18n;
        if(dict[key]) el.textContent = dict[key];
      });

      // 2. KPI Updates
      document.querySelectorAll('.currency-display').forEach(el => {
        const val = parseFloat(el.dataset.value);
        el.textContent = formatCurrency(val);
      });

      // 3. Table Update
      const tbody = document.getElementById('asset-table-body');
      tbody.innerHTML = state.assets.map(asset => {
        const name = asset.name[state.lang];
        const type = asset.type[state.lang];
        const regionFlag = asset.region === 'US' ? 'ğŸ‡ºğŸ‡¸' : 'ğŸ‡¹ğŸ‡¼';
        const regionClass = asset.region === 'US' ? 'bg-blue-50 text-blue-700' : 'bg-green-50 text-green-700';
        const highlightClass = asset.isNew ? 'bg-orange-50 fade-in-up' : '';
        const riskBadge = asset.hasRisk ? `<span class="ml-2 inline-flex items-center px-2 py-0.5 bg-orange-100 text-orange-700 text-[10px] font-bold rounded-full border border-orange-200">FATCA</span>` : '';

        return `
          <tr class="group transition-colors hover:bg-gray-50 border-b border-gray-100 last:border-0 ${highlightClass}">
            <td class="py-4 pl-2">
              <div class="font-semibold text-gray-900 group-hover:text-[#0066cc] transition-colors">${name}</div>
            </td>
            <td class="py-4">
              <span class="px-2 py-1 rounded-full text-xs font-bold ${regionClass}">${regionFlag} ${asset.region}</span>${riskBadge}
            </td>
            <td class="py-4 text-sm text-gray-600">${type}</td>
            <td class="py-4 pr-2 text-right font-mono font-bold text-gray-900">${formatCurrency(asset.valueUsd)}</td>
          </tr>
        `;
      }).join('');

      // 4. Toggle Buttons State
      document.querySelectorAll('.currency-btn').forEach(btn => {
        const isActive = btn.dataset.currency === state.currency;
        btn.className = isActive 
          ? 'currency-btn px-4 py-2 bg-white text-[#0066cc] font-semibold shadow-sm' 
          : 'currency-btn px-4 py-2 text-gray-500 hover:bg-gray-100';
      });

      document.querySelectorAll('.dropdown-item[data-lang]').forEach(item => {
        item.classList.toggle('selected', item.dataset.lang === state.lang);
      });
    }

    function updateChart() {
      const usTotal = state.assets.filter(a => a.region === 'US').reduce((acc, c) => acc + c.valueUsd, 0);
      const twTotal = state.assets.filter(a => a.region === 'TW').reduce((acc, c) => acc + c.valueUsd, 0);
      
      if (chartInstance) {
        chartInstance.data.datasets[0].data = [usTotal, twTotal];
        chartInstance.update();
      } else {
        const ctx = document.getElementById('allocationChart').getContext('2d');
        chartInstance = new Chart(ctx, {
          type: 'doughnut',
          data: {
            labels: ['US', 'TW'],
            datasets: [{
              data: [usTotal, twTotal],
              backgroundColor: ['#2563eb', '#111827'],
              borderWidth: 0,
              hoverOffset: 4
            }]
          },
          options: {
            cutout: '75%',
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } }
          }
        });
      }
    }

    /**
     * Mock Async Operations (Simulating Backend)
     */
    const mockService = {
      scanDocument: () => {
        return new Promise((resolve) => {
          const logs = [
            '> Initializing OCR Engine...',
            '> Detected Language: zh-TW (Traditional Chinese)',
            '> Parsing: "Fubon Life (Whole Life)"',
            '> Checking IRS Database...',
            '> MATCH FOUND: Form 8938 Requirement'
          ];
          
          const consoleEl = document.getElementById('scan-console');
          const progressEl = document.getElementById('progress-bar');
          let step = 0;

          const interval = setInterval(() => {
            if (step >= logs.length) {
              clearInterval(interval);
              progressEl.style.width = '100%';
              setTimeout(resolve, 500);
              return;
            }
            consoleEl.innerHTML += `<div>${logs[step]}</div>`;
            consoleEl.scrollTop = consoleEl.scrollHeight;
            progressEl.style.width = `${(step + 1) * 20}%`;
            step++;
          }, 600);
        });
      },
      
      auth: async (email, password, type) => {
        // Simulate network delay
        await new Promise(r => setTimeout(r, 800));
        
        // Mock API call
        try {
            const res = await fetch(`${APP_CONFIG.apiBase}/api/${type}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password })
            });
            return await res.json();
        } catch(e) {
            // Fallback for demo if API is down
            console.warn("API unreachable, using mock response");
            return { ok: true, user: { email } };
        }
      }
    };

    /**
     * Event Listeners
     */
    function initEventListeners() {
      // Dropdowns
      const toggleDropdown = (wrapperId, menuId) => {
        const menu = document.getElementById(menuId);
        const allMenus = document.querySelectorAll('.dropdown-menu');
        allMenus.forEach(m => {
          if (m.id !== menuId) m.classList.remove('show');
        });
        menu.classList.toggle('show');
      };

      document.getElementById('lang-wrapper').addEventListener('click', (e) => {
        e.stopPropagation();
        toggleDropdown('lang-wrapper', 'lang-menu');
      });

      document.getElementById('user-wrapper').addEventListener('click', (e) => {
        e.stopPropagation();
        toggleDropdown('user-wrapper', 'user-menu');
      });

      document.addEventListener('click', () => {
        document.querySelectorAll('.dropdown-menu').classList.remove('show'); // Fail-safe
        document.querySelectorAll('.dropdown-menu').forEach(m => m.classList.remove('show'));
      });

      // Currency Switch
      document.querySelectorAll('.currency-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation(); // Prevent bubble
          state.currency = e.target.dataset.currency;
          renderUI();
        });
      });

      // Language Switch
      document.querySelectorAll('.dropdown-item[data-lang]').forEach(item => {
        item.addEventListener('click', () => {
          state.lang = item.dataset.lang;
          renderUI();
        });
      });

      // Modals
      const toggleModal = (modalId, show) => {
        const el = document.getElementById(modalId);
        if (show) {
          el.classList.remove('hidden');
          // Small timeout for transition
          setTimeout(() => {
            el.classList.add('opacity-100');
            el.querySelector('div').classList.remove('scale-95');
            el.querySelector('div').classList.add('scale-100');
          }, 10);
        } else {
          el.classList.remove('opacity-100');
          el.querySelector('div').classList.remove('scale-100');
          el.querySelector('div').classList.add('scale-95');
          setTimeout(() => el.classList.add('hidden'), 300);
        }
      };

      document.querySelectorAll('.modal-close').forEach(btn => {
        btn.addEventListener('click', () => {
          toggleModal('modal-upload', false);
          toggleModal('modal-auth', false);
        });
      });

      // Upload Flow
      document.getElementById('btn-upload-modal').addEventListener('click', () => {
        document.getElementById('upload-step-initial').classList.remove('hidden');
        document.getElementById('upload-step-processing').classList.add('hidden');
        document.getElementById('scan-console').innerHTML = '';
        document.getElementById('progress-bar').style.width = '0%';
        toggleModal('modal-upload', true);
      });

      document.getElementById('btn-trigger-scan').addEventListener('click', async () => {
        document.getElementById('upload-step-initial').classList.add('hidden');
        document.getElementById('upload-step-processing').classList.remove('hidden');
        
        await mockService.scanDocument();
        
        // Add new asset
        const newAsset = {
          id: 99,
          name: {en:'Fubon Life (Whole Life)', zh:'å¯Œé‚¦äººå£½ (çµ‚èº«å£½éšª)'},
          type: {en:'Insurance', zh:'å„²è“„éšª'},
          region: 'TW',
          valueUsd: 52000,
          isNew: true,
          hasRisk: true
        };
        
        state.assets.unshift(newAsset);
        
        // Update KPIs
        const kpiTw = document.getElementById('kpi-tw');
        const kpiGlobal = document.getElementById('kpi-global');
        kpiTw.dataset.value = parseFloat(kpiTw.dataset.value) + 52000;
        kpiGlobal.dataset.value = parseFloat(kpiGlobal.dataset.value) + 52000;
        
        toggleModal('modal-upload', false);
        document.getElementById('risk-alert').classList.remove('hidden');
        renderUI();
        updateChart();
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });
    }

    /**
     * Init
     */
    window.addEventListener('DOMContentLoaded', () => {
      initEventListeners();
      updateChart();
      renderUI();
    });

  </script>
</body>
</html>
