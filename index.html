<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>Taimic Global | è·¨åœ‹è³‡ç”¢æŒ‡æ®ä¸­å¿ƒ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <!-- FontAwesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Google Fonts: Noto Sans TC -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Roboto', 'Noto Sans TC', sans-serif;
      background-color: #ffffff;
      color: #333333;
    }
    :root {
      --corp-blue: #005eb8;
      --corp-red: #d90015;
    }
    
    /* Navigation Hover Effect */
    .nav-link {
      position: relative;
      color: #555;
      font-weight: 500;
      font-size: 14px;
      transition: color 0.2s;
      text-decoration: none;
      display: flex;
      align-items: center;
      height: 100%;
    }
    .nav-link:hover { color: var(--corp-blue); }
    .nav-link.active { color: #333; font-weight: 700; }
    .nav-link.active::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 3px;
      background-color: var(--corp-red);
    }

    /* Scanning Animation */
    @keyframes scan {
      0% { width: 0%; opacity: 0; }
      50% { width: 100%; opacity: 1; }
      100% { width: 0%; opacity: 0; margin-left: auto; }
    }
    .scan-line {
      height: 3px;
      background: var(--corp-blue);
      animation: scan 1.5s infinite ease-in-out;
    }

    /* Fade In Animation */
    .animate-fade-in {
      animation: fadeIn 0.5s ease-out forwards;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(5px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body class="flex flex-col min-h-screen">

  <!-- Header -->
  <header class="border-b border-gray-200 sticky top-0 z-50 bg-white shadow-sm">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-20">
        
        <!-- Logo -->
        <div class="flex items-center gap-3 cursor-pointer">
          <div class="w-10 h-10 bg-[#005eb8] text-white flex items-center justify-center font-bold text-xl rounded-sm">T</div>
          <div class="flex flex-col justify-center">
            <span class="font-bold text-xl tracking-tight text-gray-800 leading-none">Taimic</span>
            <span class="text-[10px] text-[#005eb8] font-bold tracking-widest uppercase mt-1">Global Wealth</span>
          </div>
        </div>

        <!-- Navigation -->
        <nav class="hidden md:flex space-x-8 h-full items-center">
          <a href="#" class="nav-link active" data-i18n="nav.overview">Overview</a>
          <a href="#" class="nav-link" data-i18n="nav.tax">Tax & Compliance</a>
          <a href="#" class="nav-link" data-i18n="nav.estate">Estate Plan</a>
          <div class="h-6 border-l border-gray-300 mx-2"></div>
          <a href="#" class="nav-link" data-i18n="nav.us">US Assets</a>
          <a href="#" class="nav-link" data-i18n="nav.tw">TW Assets</a>
        </nav>

        <!-- Tools -->
        <div class="flex items-center gap-4">
          <div class="hidden sm:flex bg-gray-100 rounded-full p-1">
            <button onclick="setCurrency('USD')" id="btn-usd" class="px-3 py-1 text-xs font-bold rounded-full transition-all text-gray-500">USD</button>
            <button onclick="setCurrency('TWD')" id="btn-twd" class="px-3 py-1 text-xs font-bold rounded-full transition-all bg-white text-[#005eb8] shadow-sm">TWD</button>
          </div>

          <div class="flex items-center text-sm font-medium text-gray-600 gap-2 border-l border-gray-200 pl-4">
            <i class="fa-solid fa-globe"></i>
            <span class="cursor-pointer hover:text-[#005eb8]" onclick="setLang('en')" id="lang-en">EN</span>
            <span>/</span>
            <span class="cursor-pointer hover:text-[#005eb8] font-bold text-[#005eb8]" onclick="setLang('zh')" id="lang-zh">ç¹ä¸­</span>
          </div>

          <div class="w-9 h-9 bg-gray-800 text-white rounded-full flex items-center justify-center text-sm font-bold ml-2 cursor-pointer">EH</div>
        </div>
      </div>
    </div>
  </header>

  <!-- Hero Section -->
  <div class="bg-gray-50 border-b border-gray-200 py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex flex-col md:flex-row md:items-end justify-between gap-4">
        <div>
          <h1 class="text-3xl font-bold text-gray-800 mb-2" data-i18n="header.title">å…¨çƒè³‡ç”¢æŒ‡æ®ä¸­å¿ƒ</h1>
          <p class="text-gray-500 text-sm flex items-center gap-2">
            <span class="w-2 h-2 bg-green-500 rounded-full inline-block"></span>
            <span data-i18n="header.subtitle">2025 ç¨…å‹™å¹´åº¦è·¨åœ‹è³‡ç”¢æ•´åˆè¦–åœ–</span>
          </p>
        </div>
        <button onclick="openModal()" class="bg-[#005eb8] hover:bg-[#004a94] text-white px-6 py-3 rounded-sm text-sm font-bold flex items-center gap-2 shadow-sm transition-colors">
          <i class="fa-solid fa-plus"></i> <span data-i18n="btn.add">æ–°å¢è³‡ç”¢</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 flex-grow w-full">
    
    <!-- Stats Row -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
      <div class="bg-white p-6 border border-gray-200 rounded-sm shadow-sm">
        <div class="flex justify-between items-start mb-2">
          <h3 class="text-xs font-bold text-gray-500 uppercase tracking-wider" data-i18n="stats.us_net">ç¾åœ‹ç¸½è³‡ç”¢</h3>
          <span class="text-xl">ğŸ‡ºğŸ‡¸</span>
        </div>
        <div class="text-3xl font-bold text-gray-800 tracking-tight mb-1 val-display" data-usd="482500"></div>
        <div class="text-xs font-bold text-green-600 flex items-center gap-1"><i class="fa-solid fa-arrow-trend-up"></i> +4.2% YTD</div>
      </div>

      <div class="bg-white p-6 border border-gray-200 rounded-sm shadow-sm">
        <div class="flex justify-between items-start mb-2">
          <h3 class="text-xs font-bold text-gray-500 uppercase tracking-wider" data-i18n="stats.tw_net">å°ç£ç¸½è³‡ç”¢</h3>
          <span class="text-xl">ğŸ‡¹ğŸ‡¼</span>
        </div>
        <div class="text-3xl font-bold text-gray-800 tracking-tight mb-1 val-display" data-usd="315200" id="stat-tw"></div>
        <div class="text-xs font-bold text-green-600 flex items-center gap-1"><i class="fa-solid fa-arrow-trend-up"></i> +1.8% YTD</div>
      </div>

      <div class="bg-white p-6 border border-gray-200 rounded-sm shadow-sm border-l-4 border-l-gray-800">
        <div class="flex justify-between items-start mb-2">
          <h3 class="text-xs font-bold text-gray-500 uppercase tracking-wider" data-i18n="stats.global">å…¨çƒç¸½æ·¨å€¼</h3>
          <span class="text-xl">ğŸŒ</span>
        </div>
        <div class="text-3xl font-bold text-gray-800 tracking-tight mb-1 val-display" data-usd="797700" id="stat-global"></div>
        <div class="text-xs font-bold text-[#005eb8] flex items-center gap-1">
          <i class="fa-solid fa-shield-check"></i> <span data-i18n="stats.estate_safe">éºç”¢ç¨…å®‰å…¨æ°´ä½</span>
        </div>
      </div>
    </div>

    <!-- Dashboard Columns -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      
      <!-- Left: Assets -->
      <div class="lg:col-span-2 space-y-8">
        
        <!-- AI Alert -->
        <div id="ai-alert" class="hidden bg-orange-50 border-l-4 border-orange-500 p-4 flex gap-4 animate-fade-in">
          <div class="bg-white p-2 rounded-full h-10 w-10 flex items-center justify-center text-orange-500 shadow-sm">
             <i class="fa-solid fa-triangle-exclamation"></i>
          </div>
          <div>
            <h4 class="font-bold text-gray-800 text-sm" data-i18n="alert.title">AI ç¨…å‹™è­¦ç¤º</h4>
            <p class="text-gray-600 text-sm mt-1 leading-relaxed" data-i18n="alert.text">åµæ¸¬åˆ°é«˜ç¾é‡‘åƒ¹å€¼ä¿å–®ã€‚å¯èƒ½éœ€è¦ç”³å ± FATCA (è‚¥å’–æ¢æ¬¾)ã€‚</p>
            <button class="mt-2 text-xs font-bold text-[#005eb8] hover:underline">View IRS Form 8938 Analysis &rarr;</button>
          </div>
        </div>

        <!-- Asset Table -->
        <div class="bg-white border border-gray-200 rounded-sm shadow-sm">
          <div class="px-6 py-4 border-b border-gray-200 bg-gray-50 flex justify-between items-center">
            <h3 class="font-bold text-gray-800" data-i18n="table.title">æŠ•è³‡çµ„åˆæŒå€‰</h3>
            <span class="text-xs text-gray-400 font-mono">Data Source: Live API</span>
          </div>
          <div class="overflow-x-auto">
            <table class="w-full text-left text-sm">
              <thead>
                <tr class="bg-white text-gray-500 border-b border-gray-200">
                  <th class="px-6 py-4 font-semibold" data-i18n="table.name">è³‡ç”¢åç¨±</th>
                  <th class="px-6 py-4 font-semibold" data-i18n="table.jurisdiction">ç®¡è½„å€</th>
                  <th class="px-6 py-4 font-semibold" data-i18n="table.category">é¡åˆ¥</th>
                  <th class="px-6 py-4 font-semibold text-right" data-i18n="table.value">ç¾å€¼</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-gray-100" id="asset-list">
                <!-- JS Injected -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Right: Charts -->
      <div class="space-y-6">
        <div class="bg-white border border-gray-200 rounded-sm shadow-sm p-6">
          <h3 class="font-bold text-gray-800 mb-6" data-i18n="geo.title">è³‡ç”¢å€åŸŸé…ç½®</h3>
          <div class="h-64 w-full relative">
            <canvas id="geoChart"></canvas>
            <div class="absolute inset-0 flex items-center justify-center pointer-events-none pb-6">
              <div class="text-center">
                <div class="text-xs text-gray-400 font-bold uppercase">Total</div>
                <div class="text-sm font-bold text-gray-800">100%</div>
              </div>
            </div>
          </div>
          
          <div class="bg-blue-50 p-4 border border-blue-100 rounded-sm mt-4">
            <div class="text-xs font-bold text-[#005eb8] mb-1 uppercase tracking-wider flex items-center gap-1">
              <i class="fa-solid fa-robot"></i> <span data-i18n="geo.insight">AI æ™ºèƒ½åˆ†æ</span>
            </div>
            <p class="text-xs text-gray-600 leading-relaxed" data-i18n="geo.insight_text">
              æ‚¨çš„å°ç£è³‡ç”¢ä½”ç¸½æ·¨å€¼çš„ 40%ã€‚å»ºè­°ç•™æ„å°å¹£åŒ¯ç‡é¢¨éšªã€‚
            </p>
          </div>
        </div>

        <div class="bg-[#1e293b] text-white p-6 rounded-sm shadow-lg">
          <h4 class="font-bold text-sm mb-2"><i class="fa-solid fa-headset mr-2"></i>Need Estate Planning?</h4>
          <p class="text-xs text-gray-400 mb-4 leading-relaxed">Contact our certified cross-border tax specialists to optimize your legacy plan.</p>
          <button class="w-full bg-white text-[#1e293b] py-2 text-xs font-bold uppercase tracking-wide hover:bg-gray-100 transition-colors rounded-sm">
            Contact Support
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="bg-[#111] text-white py-12 border-t border-gray-800 mt-auto">
    <div class="max-w-7xl mx-auto px-4 text-center">
      <p class="text-xs text-gray-500 mb-2">&copy; 2025 Taimic Inc. All Rights Reserved.</p>
    </div>
  </footer>

  <!-- Modal -->
  <div id="modal-overlay" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-sm shadow-2xl w-full max-w-md overflow-hidden relative animate-fade-in">
      <div class="bg-[#005eb8] p-4 flex justify-between items-center">
        <h3 class="text-white font-bold text-sm flex items-center gap-2">
           <i class="fa-solid fa-file-import"></i> <span data-i18n="modal.title">æ–°å¢å°ç£è³‡ç”¢</span>
        </h3>
        <i class="fa-solid fa-xmark text-white cursor-pointer text-lg hover:opacity-75" onclick="closeModal()"></i>
      </div>
      
      <div class="p-8 text-center" id="modal-step-1">
        <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4 text-gray-400">
           <i class="fa-solid fa-cloud-arrow-up text-3xl"></i>
        </div>
        <p class="text-sm text-gray-600 mb-6 leading-relaxed" data-i18n="modal.desc">ä¸Šå‚³ä¿å–®æˆ–å°å¸³å–®ï¼ŒAI å°‡è‡ªå‹•æå–ç¨…å‹™æ•¸æ“šã€‚</p>
        <button onclick="startScan()" class="w-full border-2 border-dashed border-gray-300 py-8 rounded-sm hover:border-[#005eb8] hover:bg-blue-50 transition-all text-gray-500 hover:text-[#005eb8] font-bold text-sm group">
          <span class="group-hover:scale-105 inline-block transition-transform" data-i18n="btn.upload">é»æ“Šä¸Šå‚³ç…§ç‰‡</span>
        </button>
      </div>

      <div class="p-8 hidden" id="modal-step-2">
        <h3 class="text-center font-bold text-gray-800 mb-6 flex items-center justify-center gap-2">
           <i class="fa-solid fa-circle-notch fa-spin text-[#005eb8]"></i> <span data-i18n="btn.analyzing">AI åˆ†æä¸­...</span>
        </h3>
        <div class="text-left space-y-3 bg-gray-50 p-4 rounded border border-gray-100 font-mono">
          <div class="flex items-center gap-3 text-xs text-gray-700" id="step-txt-1">
            <div class="w-3 h-3 border border-gray-300 rounded-full"></div> <span data-i18n="modal.step1">åµæ¸¬èªè¨€...</span>
          </div>
          <div class="flex items-center gap-3 text-xs text-gray-700" id="step-txt-2">
            <div class="w-3 h-3 border border-gray-300 rounded-full"></div> <span data-i18n="modal.step2">è§£ææ•¸å€¼...</span>
          </div>
           <div class="flex items-center gap-3 text-xs text-gray-700" id="step-txt-3">
            <div class="w-3 h-3 border border-gray-300 rounded-full"></div> <span data-i18n="modal.step3">æ¯”å° IRS...</span>
          </div>
        </div>
        <div class="mt-6 h-1 w-full bg-gray-200 rounded-full overflow-hidden">
           <div class="scan-line w-full"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Logic -->
  <script>
    const EXCHANGE_RATE = 32.5;
    let currentLang = 'zh';
    let currentCurr = 'TWD';

    let assets = [
      { id: 1, name: 'Vanguard Total Stock (VTI)', namezh: 'Vanguard å…¨çƒè‚¡ç¥¨ ETF (VTI)', type: 'ETF', typezh: 'æŒ‡æ•¸å‹åŸºé‡‘', country: 'US', valueUsd: 145200, category: 'Investment', categoryzh: 'æŠ•è³‡' },
      { id: 2, name: 'Taipei Xinyi Condo', namezh: 'å°åŒ—ä¿¡ç¾©å€å…¬å¯“', type: 'Real Estate', typezh: 'æˆ¿åœ°ç”¢', country: 'TW', valueUsd: 280000, category: 'Property', categoryzh: 'ä¸å‹•ç”¢' },
      { id: 3, name: 'Fidelity 401(k)', namezh: 'å¯Œé”é€€ä¼‘é‡‘å¸³æˆ¶ 401(k)', type: 'Retirement', typezh: 'é€€ä¼‘é‡‘', country: 'US', valueUsd: 98500, category: 'Retirement', categoryzh: 'é€€ä¼‘è¦åŠƒ' },
    ];

    const TRANSLATIONS = {
      en: {
        'nav.overview': 'Overview', 'nav.tax': 'Tax & Compliance', 'nav.estate': 'Estate Plan', 'nav.us': 'US Assets', 'nav.tw': 'TW Assets',
        'header.title': 'Global Asset Command', 'header.subtitle': 'Consolidated view for Tax Year 2025',
        'stats.us_net': 'US Net Worth', 'stats.tw_net': 'Taiwan Net Worth', 'stats.global': 'Global Total', 'stats.estate_safe': 'Estate Tax Safe',
        'table.title': 'Portfolio Holdings', 'table.name': 'Asset Name', 'table.jurisdiction': 'Jurisdiction', 'table.category': 'Category', 'table.value': 'Value',
        'geo.title': 'Geo-Allocation', 'geo.insight': 'AI INSIGHT', 'geo.insight_text': 'Your Taiwan assets comprise 40% of your net worth. Consider hedging currency risk.',
        'alert.title': 'AI Tax Alert', 'alert.text': 'High cash-value insurance detected. Potential FATCA reporting required.',
        'btn.add': 'Add Asset', 'btn.upload': 'Click to Upload', 'btn.analyzing': 'AI Analyzing...',
        'modal.title': 'Add Taiwan Asset', 'modal.desc': 'Upload policy or statement. AI will extract tax data.', 
        'modal.step1': 'Detecting Language: Traditional Chinese', 'modal.step2': 'Parsing Values: Cash Value', 'modal.step3': 'Checking IRS Form 8938 Codes'
      },
      zh: {
        'nav.overview': 'è³‡ç”¢ç¸½è¦½', 'nav.tax': 'ç¨…å‹™åˆè¦', 'nav.estate': 'å‚³æ‰¿è¦åŠƒ', 'nav.us': 'ç¾åœ‹è³‡ç”¢', 'nav.tw': 'å°ç£è³‡ç”¢',
        'header.title': 'å…¨çƒè³‡ç”¢æŒ‡æ®ä¸­å¿ƒ', 'header.subtitle': '2025 ç¨…å‹™å¹´åº¦è·¨åœ‹è³‡ç”¢æ•´åˆè¦–åœ–',
        'stats.us_net': 'ç¾åœ‹ç¸½è³‡ç”¢', 'stats.tw_net': 'å°ç£ç¸½è³‡ç”¢', 'stats.global': 'å…¨çƒç¸½æ·¨å€¼', 'stats.estate_safe': 'éºç”¢ç¨…å®‰å…¨æ°´ä½',
        'table.title': 'æŠ•è³‡çµ„åˆæŒå€‰', 'table.name': 'è³‡ç”¢åç¨±', 'table.jurisdiction': 'ç®¡è½„å€', 'table.category': 'é¡åˆ¥', 'table.value': 'ç¾å€¼',
        'geo.title': 'è³‡ç”¢å€åŸŸé…ç½®', 'geo.insight': 'AI æ™ºèƒ½åˆ†æ', 'geo.insight_text': 'æ‚¨çš„å°ç£è³‡ç”¢ä½”ç¸½æ·¨å€¼çš„ 40%ã€‚å»ºè­°ç•™æ„å°å¹£åŒ¯ç‡é¢¨éšªã€‚',
        'alert.title': 'AI ç¨…å‹™è­¦ç¤º', 'alert.text': 'åµæ¸¬åˆ°é«˜ç¾é‡‘åƒ¹å€¼ä¿å–®ã€‚å¯èƒ½éœ€è¦ç”³å ± FATCA (è‚¥å’–æ¢æ¬¾)ã€‚',
        'btn.add': 'æ–°å¢è³‡ç”¢', 'btn.upload': 'é»æ“Šä¸Šå‚³ç…§ç‰‡', 'btn.analyzing': 'AI åˆ†æä¸­...',
        'modal.title': 'æ–°å¢å°ç£è³‡ç”¢', 'modal.desc': 'ä¸Šå‚³ä¿å–®æˆ–å°å¸³å–®ï¼ŒAI å°‡è‡ªå‹•æå–ç¨…å‹™æ•¸æ“šã€‚',
        'modal.step1': 'åµæ¸¬èªè¨€ï¼šç¹é«”ä¸­æ–‡...', 'modal.step2': 'è§£ææ•¸å€¼ï¼šç¾é‡‘åƒ¹å€¼...', 'modal.step3': 'æ¯”å° IRS ç¨…æ³•ä»£ç¢¼...'
      }
    };

    let geoChart;
    function initChart() {
      const ctx = document.getElementById('geoChart').getContext('2d');
      geoChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: ['US Assets', 'TW Assets'],
          datasets: [{
            data: [243700, 280000],
            backgroundColor: ['#005eb8', '#00a651'],
            borderWidth: 2,
            borderColor: '#ffffff',
            hoverOffset: 4
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          cutout: '75%',
          plugins: {
            legend: { position: 'bottom', labels: { usePointStyle: true, font: { size: 11, family: "'Roboto', sans-serif" }, padding: 20 } }
          }
        }
      });
    }

    function renderTable() {
      const tbody = document.getElementById('asset-list');
      tbody.innerHTML = '';
      
      assets.forEach(asset => {
        const name = currentLang === 'zh' && asset.namezh ? asset.namezh : asset.name;
        const type = currentLang === 'zh' && asset.typezh ? asset.typezh : asset.type;
        const cat = currentLang === 'zh' && asset.categoryzh ? asset.categoryzh : asset.category;
        const isUS = asset.country === 'US';
        const badgeClass = isUS ? 'bg-blue-50 text-blue-700' : 'bg-green-50 text-green-700';
        const badgeText = isUS ? 'USA' : 'TWN';
        const bgClass = asset.isNew ? 'bg-orange-50 animate-fade-in' : '';
        let riskTag = '';
        if(asset.risk) {
           riskTag = `<span class="ml-2 inline-flex items-center px-2 py-0.5 bg-orange-100 text-orange-700 text-[10px] font-bold rounded border border-orange-200"><i class="fa-solid fa-bolt mr-1"></i> FATCA</span>`;
        }

        const row = `
          <tr class="hover:bg-gray-50 transition-colors ${bgClass} group border-b border-gray-100 last:border-0">
            <td class="px-6 py-4">
              <div class="flex items-center gap-3">
                <div class="w-8 h-8 rounded-md flex items-center justify-center text-white text-xs font-bold shadow-sm ${isUS ? 'bg-blue-600' : 'bg-green-600'}">${asset.country}</div>
                <div><div class="font-bold text-gray-800 group-hover:text-[#005eb8] transition-colors">${name}</div><div class="text-xs text-gray-500">${type}</div></div>
              </div>
            </td>
            <td class="px-6 py-4"><span class="inline-flex items-center px-2 py-1 text-xs font-bold rounded ${badgeClass}">${badgeText}</span>${riskTag}</td>
            <td class="px-6 py-4 text-gray-600 text-xs font-medium uppercase tracking-wide">${cat}</td>
            <td class="px-6 py-4 text-right font-bold text-gray-800 tracking-tight val-display font-mono" data-usd="${asset.valueUsd}">...</td>
          </tr>
        `;
        tbody.innerHTML += row;
      });
      updateValues();
    }

    function formatMoney(valUsd) {
      if (currentCurr === 'USD') {
        return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: 0 }).format(valUsd);
      } else {
        return new Intl.NumberFormat('zh-TW', { style: 'currency', currency: 'TWD', maximumFractionDigits: 0 }).format(valUsd * EXCHANGE_RATE);
      }
    }

    function updateValues() {
      document.querySelectorAll('.val-display').forEach(el => {
        const val = parseFloat(el.getAttribute('data-usd'));
        el.textContent = formatMoney(val);
      });

      const btnUsd = document.getElementById('btn-usd');
      const btnTwd = document.getElementById('btn-twd');
      const activeClass = "bg-white text-[#005eb8] shadow-sm";
      const inactiveClass = "text-gray-500";

      if (currentCurr === 'USD') {
        btnUsd.className = `px-3 py-1 text-xs font-bold rounded-full transition-all ${activeClass}`;
        btnTwd.className = `px-3 py-1 text-xs font-bold rounded-full transition-all ${inactiveClass}`;
      } else {
        btnUsd.className = `px-3 py-1 text-xs font-bold rounded-full transition-all ${inactiveClass}`;
        btnTwd.className = `px-3 py-1 text-xs font-bold rounded-full transition-all ${activeClass}`;
      }
    }

    function updateText() {
      const t = TRANSLATIONS[currentLang];
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (t[key]) el.textContent = t[key];
      });
      
      const enBtn = document.getElementById('lang-en');
      const zhBtn = document.getElementById('lang-zh');
      const activeClass = "cursor-pointer hover:text-[#005eb8] font-bold text-[#005eb8]";
      const inactiveClass = "cursor-pointer hover:text-[#005eb8] text-gray-500";

      if(currentLang === 'en') {
        enBtn.className = activeClass;
        zhBtn.className = inactiveClass;
      } else {
        enBtn.className = inactiveClass;
        zhBtn.className = activeClass;
      }
      renderTable();
    }

    function setCurrency(c) { currentCurr = c; updateValues(); }
    function setLang(l) { currentLang = l; updateText(); }
    function openModal() { document.getElementById('modal-overlay').classList.remove('hidden'); document.getElementById('modal-step-1').classList.remove('hidden'); document.getElementById('modal-step-2').classList.add('hidden'); }
    function closeModal() { document.getElementById('modal-overlay').classList.add('hidden'); }

    function startScan() {
      document.getElementById('modal-step-1').classList.add('hidden');
      document.getElementById('modal-step-2').classList.remove('hidden');

      const s1 = document.getElementById('step-txt-1');
      const s2 = document.getElementById('step-txt-2');
      const s3 = document.getElementById('step-txt-3');
      const checkIcon = '<i class="fa-solid fa-check text-green-500"></i>';

      setTimeout(() => { s1.children[0].outerHTML = checkIcon; s1.classList.add('font-bold'); }, 1000);
      setTimeout(() => { s2.children[0].outerHTML = checkIcon; s2.classList.add('font-bold'); }, 2000);
      setTimeout(() => { s3.children[0].outerHTML = checkIcon; s3.classList.add('font-bold'); }, 3000);

      setTimeout(() => {
        const newAsset = {
          id: Date.now(), name: 'Fubon Life (Whole Life)', namezh: 'å¯Œé‚¦äººå£½ (çµ‚èº«å£½éšª)',
          type: 'Insurance', typezh: 'å„²è“„éšª', country: 'TW', valueUsd: 52000,
          category: 'Insurance', categoryzh: 'ä¿éšª', isNew: true, risk: 'FATCA'
        };
        assets.unshift(newAsset);
        
        const twStat = document.getElementById('stat-tw');
        const glStat = document.getElementById('stat-global');
        const newTwVal = parseFloat(twStat.getAttribute('data-usd')) + 52000;
        const newGlVal = parseFloat(glStat.getAttribute('data-usd')) + 52000;
        
        twStat.setAttribute('data-usd', newTwVal);
        glStat.setAttribute('data-usd', newGlVal);

        geoChart.data.datasets[0].data[1] += 52000; 
        geoChart.update();

        document.getElementById('ai-alert').classList.remove('hidden');
        renderTable();
        updateValues();
        closeModal();
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }, 3800);
    }

    window.onload = function() {
      initChart();
      renderTable();
      updateValues();
    }
  </script>
</body>
</html>
